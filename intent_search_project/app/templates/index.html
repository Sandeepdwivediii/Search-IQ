<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SearchIQ - AI-Powered Product Discovery & Parts Recommendation</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta name="description" content="Advanced AI-powered search engine for product discovery and intelligent spare parts recommendations">
    <meta name="keywords" content="AI search, product discovery, spare parts, recommendations, e-commerce">
</head>
<body>
    <!-- Enhanced Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="nav-logo-wrapper">
                    <div class="nav-logo">
                        <i class="fas fa-brain"></i>
                        <div class="logo-pulse"></div>
                    </div>
                    <div class="brand-text">
                        <span class="brand-name">SearchIQ</span>
                        <span class="brand-tagline">AI</span>
                    </div>
                </div>
            </div>
            <div class="nav-menu">
                <a href="#features" class="nav-link">
                    <span>Features</span>
                    <div class="nav-underline"></div>
                </a>
                <a href="#about" class="nav-link">
                    <span>About</span>
                    <div class="nav-underline"></div>
                </a>
                <a href="#contact" class="nav-link">
                    <span>Contact</span>
                    <div class="nav-underline"></div>
                </a>
                <button class="nav-cta">
                    <span>Get Started</span>
                    <i class="fas fa-arrow-right"></i>
                    <div class="btn-shine"></div>
                </button>
            </div>
            <div class="mobile-menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Enhanced Hero Section -->
    <section class="hero-section">
        <div class="hero-background">
            <div class="hero-particles"></div>
            <div class="hero-gradient"></div>
        </div>
        <div class="hero-container">
            <div class="hero-content">
                <div class="hero-badge">
                    <div class="badge-glow"></div>
                    <i class="fas fa-sparkles"></i>
                    <span>AI-Driven Intelligence</span>
                </div>
                <h1 class="hero-title">
                    Find Exactly What You Need
                    <span class="gradient-text">Every Time</span>
                </h1>
                <p class="hero-description">
                    Experience the future of search with our AI-powered platform. Discover products 
                    effortlessly and get intelligent spare parts recommendations with stunning precision.
                </p>
                <div class="hero-stats">
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">20K+</span>
                            <span class="stat-label">Products Indexed</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">99%</span>
                            <span class="stat-label">AI Accuracy</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">&lt; 1s</span>
                            <span class="stat-label">Response Time</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="hero-visual">
                <div class="floating-cards">
                    <div class="floating-card card-1">
                        <div class="card-glow"></div>
                        <i class="fas fa-laptop"></i>
                        <span>Laptops</span>
                        <div class="card-particles"></div>
                    </div>
                    <div class="floating-card card-2">
                        <div class="card-glow"></div>
                        <i class="fas fa-headphones"></i>
                        <span>Audio</span>
                        <div class="card-particles"></div>
                    </div>
                    <div class="floating-card card-3">
                        <div class="card-glow"></div>
                        <i class="fas fa-tools"></i>
                        <span>Parts</span>
                        <div class="card-particles"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Enhanced Main Application -->
    <main class="main-app">
        <div class="app-container">
            <!-- Beautiful Navigation Tabs -->
            <div class="tab-navigation">
                <div class="tab-wrapper">
                    <button class="tab-btn active" onclick="showTab('search', this)" data-tab="search">
                        <div class="tab-bg"></div>
                        <div class="tab-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="tab-content-text">
                            <span class="tab-title">Product Search</span>
                            <span class="tab-subtitle">AI-powered discovery</span>
                        </div>
                        <div class="tab-glow"></div>
                    </button>
                    <button class="tab-btn" onclick="showTab('spare-parts', this)" data-tab="spare-parts">
                        <div class="tab-bg"></div>
                        <div class="tab-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="tab-content-text">
                            <span class="tab-title">Smart Parts</span>
                            <span class="tab-subtitle">AI recommendations</span>
                        </div>
                        <div class="tab-glow"></div>
                    </button>
                </div>
                <div class="tab-indicator"></div>
            </div>

            <!-- Enhanced Product Search Tab -->
            <div id="search-tab" class="tab-content active">
                <div class="search-section">
                    <div class="search-header">
                        <h2 class="section-title">
                            <div class="title-icon">
                                <i class="fas fa-search"></i>
                                <div class="icon-ripple"></div>
                            </div>
                            Product Discovery
                        </h2>
                        <p class="section-description">
                            Tell us what you're looking for, and our AI will find the perfect match
                        </p>
                    </div>

                    <div class="search-form-container">
                        <form id="searchForm" class="search-form">
                            <div class="search-input-wrapper">
                                <div class="search-input-container">
                                    <div class="input-glow"></div>
                                    <i class="fas fa-search search-icon"></i>
                                    <input 
                                        type="text" 
                                        id="searchQuery" 
                                        placeholder="What are you looking for? (e.g., gaming laptop under 80000)" 
                                        class="search-input"
                                        autocomplete="off"
                                        required
                                    >
                                    <button type="submit" class="search-submit-btn">
                                        <i class="fas fa-arrow-right"></i>
                                        <div class="btn-ripple"></div>
                                    </button>
                                </div>
                                <div class="search-suggestions" id="searchSuggestions"></div>
                            </div>
                        </form>

                        <div class="quick-search">
                            <span class="quick-search-label">Popular searches:</span>
                            <div class="quick-search-tags">
                                <button class="quick-tag" onclick="searchExample('gaming laptop')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-laptop"></i>
                                    <span>Gaming Laptop</span>
                                </button>
                                <button class="quick-tag" onclick="searchExample('wireless headphones')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-headphones"></i>
                                    <span>Wireless Headphones</span>
                                </button>
                                <button class="quick-tag" onclick="searchExample('smartphone under 20000')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-mobile-alt"></i>
                                    <span>Budget Phone</span>
                                </button>
                                <button class="quick-tag" onclick="searchExample('kitchen appliances')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-blender"></i>
                                    <span>Kitchen</span>
                                </button>
                                <button class="quick-tag" onclick="searchExample('fitness equipment')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-dumbbell"></i>
                                    <span>Fitness</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Loading Indicator -->
                    <div id="loadingIndicator" class="loading-container" style="display: none;">
                        <div class="loading-spinner">
                            <div class="spinner-ring ring-1"></div>
                            <div class="spinner-ring ring-2"></div>
                            <div class="spinner-ring ring-3"></div>
                            <div class="spinner-center">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <p class="loading-text">Analyzing your search with AI intelligence...</p>
                        <div class="loading-progress">
                            <div class="progress-bar">
                                <div class="progress-shine"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div id="searchResults" class="results-section" style="display: none;"></div>
                </div>
            </div>

            <!-- ENHANCED INTELLIGENT SPARE PARTS TAB -->
            <div id="spare-parts-tab" class="tab-content" style="display: none;">
                <div class="spare-parts-section">
                    <!-- Enhanced but compatible header -->
                    <div class="section-header">
                        <h2 class="section-title">
                            <div class="title-icon">
                                <i class="fas fa-brain"></i>
                                <div class="icon-ripple"></div>
                            </div>
                            Smart Parts Recommendation
                        </h2>
                        <p class="section-description">
                            Describe your problem in natural language - our AI will find the perfect parts
                        </p>
                    </div>

                    <!-- Enhanced but compatible input section -->
                    <div class="spare-parts-form-container">
                        <div class="form-card">
                            <div class="card-glow-bg"></div>
                            
                            <!-- AI Badge using existing classes -->
                            <div class="form-header">
                                <div class="ai-status-badge">
                                    <i class="fas fa-sparkles"></i>
                                    <span>No Model Numbers Required - Just Describe Your Problem</span>
                                </div>
                                <h3>Intelligent Problem Analysis</h3>
                                <p>Tell us what's wrong with your device in plain English</p>
                            </div>
                            
                            <!-- Main problem description (enhanced but compatible) -->
                            <div class="form-group">
                                <label for="problem-description" class="form-label">
                                    <i class="fas fa-comment-medical"></i>
                                    Problem Description
                                    <span class="ai-indicator">✨ AI-Powered</span>
                                </label>
                                <div class="textarea-wrapper">
                                    <textarea 
                                        id="problem-description" 
                                        placeholder="Example: My Samsung phone battery drains really fast and won't hold charge for more than 2 hours..."
                                        rows="5"
                                        class="form-textarea smart-textarea"
                                        maxlength="500"
                                    ></textarea>
                                    
                                    <!-- Enhanced controls using existing structure -->
                                    <div class="textarea-controls">
                                        <button id="voice-input-btn" class="voice-input-button" type="button" title="Voice Input">
                                            <i class="fas fa-microphone"></i>
                                            <span class="voice-status">Voice Input</span>
                                        </button>
                                        <div class="char-counter">
                                            <span id="char-count">0</span>/500 characters
                                        </div>
                                    </div>
                                    
                                    <div class="textarea-focus"></div>
                                </div>
                                <div class="form-help">
                                    💡 The more details you provide, the better our AI recommendations will be
                                </div>
                            </div>

                            <!-- Real-time AI analysis preview (using existing classes) -->
                            <div id="analysis-preview" class="analysis-preview-card" style="display: none;">
                                <div class="form-header">
                                    <h4>
                                        <i class="fas fa-brain"></i>
                                        AI Analysis Preview
                                    </h4>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Detected Device:</label>
                                        <span id="detected-device-text" class="analysis-result">-</span>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Issues Found:</label>
                                        <div id="detected-issues-tags" class="issues-tags"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Optional fields (simplified, keeping your structure) -->
                            <div class="advanced-options" style="display: none;">
                                <h4>Optional Information (AI can work without this)</h4>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="brand-select" class="form-label">
                                            <i class="fas fa-building"></i>
                                            Device Brand (Optional)
                                        </label>
                                        <div class="select-wrapper">
                                            <select id="brand-select" class="form-select">
                                                <option value="">Auto-detect from description</option>
                                                <option value="samsung">Samsung</option>
                                                <option value="apple">Apple</option>
                                                <option value="lg">LG</option>
                                                <option value="xiaomi">Xiaomi</option>
                                                <option value="hp">HP</option>
                                                <option value="dell">Dell</option>
                                            </select>
                                            <i class="fas fa-chevron-down select-arrow"></i>
                                            <div class="select-focus"></div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="device-model" class="form-label">
                                            <i class="fas fa-tag"></i>
                                            Model Number (Optional)
                                        </label>
                                        <div class="input-wrapper">
                                            <input 
                                                type="text" 
                                                id="device-model" 
                                                placeholder="e.g., Galaxy S24, MacBook Pro M3"
                                                class="form-input"
                                            >
                                            <div class="input-focus"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Show/Hide advanced options -->
                            <div class="form-group">
                                <button type="button" class="show-advanced-btn" onclick="toggleAdvancedOptions()">
                                    <i class="fas fa-cog"></i>
                                    <span>Show Advanced Options</span>
                                    <i class="fas fa-chevron-down arrow"></i>
                                </button>
                            </div>

                            <!-- Main search button (enhanced) -->
                            <div class="form-group">
                                <button id="search-spare-parts-btn" class="btn-primary-large ai-search-button">
                                    <div class="btn-bg"></div>
                                    <i class="fas fa-brain"></i>
                                    <span>Analyze with AI</span>
                                    <div class="btn-shine"></div>
                                    <div class="ai-glow"></div>
                                </button>
                            </div>

                            <!-- Search options -->
                            <div class="form-group">
                                <div class="search-options-grid">
                                    <label class="checkbox-label ai-toggle">
                                        <input type="checkbox" id="premium-analysis" checked>
                                        <span class="checkmark premium-check"></span>
                                        <span class="option-text">
                                            <i class="fas fa-crown"></i>
                                            Premium AI Analysis
                                        </span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="include-alternatives" checked>
                                        <span class="checkmark"></span>
                                        <span class="option-text">Include alternative parts</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced issue examples using existing structure -->
                        <div class="issue-examples">
                            <h4>
                                <i class="fas fa-lightning-bolt"></i>
                                Quick Examples - Try These:
                            </h4>
                            <div class="issue-tags">
                                <button class="issue-tag smart-example" onclick="fillProblemExample('My phone battery drains very fast and dies within 2 hours')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-battery-quarter"></i>
                                    <span>Battery Issues</span>
                                </button>
                                <button class="issue-tag smart-example" onclick="fillProblemExample('My laptop screen flickers and sometimes goes black')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-desktop"></i>
                                    <span>Screen Problems</span>
                                </button>
                                <button class="issue-tag smart-example" onclick="fillProblemExample('My AC is not cooling properly and makes strange noise')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-snowflake"></i>
                                    <span>Cooling Issues</span>
                                </button>
                                <button class="issue-tag smart-example" onclick="fillProblemExample('My washing machine is leaking water from the door')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-tint"></i>
                                    <span>Water Leakage</span>
                                </button>
                                <button class="issue-tag smart-example" onclick="fillProblemExample('My TV remote is not responding to button presses')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-tv"></i>
                                    <span>Remote Issues</span>
                                </button>
                                <button class="issue-tag smart-example" onclick="fillProblemExample('My headphones left side has no sound')">
                                    <div class="tag-bg"></div>
                                    <i class="fas fa-headphones"></i>
                                    <span>Audio Problems</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced loading using existing structure -->
                    <div id="loading-indicator" class="loading-container ai-loading" style="display: none;">
                        <div class="loading-spinner">
                            <div class="spinner-ring ring-1"></div>
                            <div class="spinner-ring ring-2"></div>
                            <div class="spinner-ring ring-3"></div>
                            <div class="spinner-center">
                                <i class="fas fa-brain"></i>
                            </div>
                        </div>
                        <h3>AI is Analyzing Your Request</h3>
                        <p id="loading-status" class="loading-text">Processing natural language and finding compatible parts...</p>
                        
                        <!-- Enhanced progress with AI steps -->
                        <div class="loading-progress">
                            <div class="progress-bar ai-progress">
                                <div class="progress-shine"></div>
                            </div>
                        </div>
                        
                        <div class="ai-progress-steps">
                            <div class="progress-step active">
                                <i class="fas fa-language"></i>
                                <span>Understanding Problem</span>
                            </div>
                            <div class="progress-step">
                                <i class="fas fa-search"></i>
                                <span>Finding Parts</span>
                            </div>
                            <div class="progress-step">
                                <i class="fas fa-chart-line"></i>
                                <span>Ranking Results</span>
                            </div>
                            <div class="progress-step">
                                <i class="fas fa-gift"></i>
                                <span>Personalizing</span>
                            </div>
                        </div>
                    </div>

                    <!-- AI Analysis Summary (using existing classes) -->
                    <div id="analysis-summary" class="analysis-summary-section" style="display: none;">
                        <!-- Will be populated by JavaScript -->
                    </div>

                    <!-- Results using existing structure -->
                    <div id="recommendations-container" class="results-section">
                        <!-- Will be populated by enhanced JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Enhanced Features Section -->
    <section id="features" class="features-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Why Choose SearchIQ?</h2>
                <p class="section-description">Advanced AI technology meets beautiful design</p>
            </div>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-bg"></div>
                    <div class="feature-icon">
                        <i class="fas fa-brain"></i>
                        <div class="icon-glow"></div>
                    </div>
                    <h3>AI-Powered Search</h3>
                    <p>Our advanced machine learning algorithms understand context and intent to deliver precise results.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-bg"></div>
                    <div class="feature-icon">
                        <i class="fas fa-bolt"></i>
                        <div class="icon-glow"></div>
                    </div>
                    <h3>Lightning Fast</h3>
                    <p>Get results in under 1 second with our optimized search infrastructure and intelligent caching.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-bg"></div>
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                        <div class="icon-glow"></div>
                    </div>
                    <h3>Reliable & Accurate</h3>
                    <p>99% accuracy rate with continuously improving AI models and quality-checked data.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-bg"></div>
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                        <div class="icon-glow"></div>
                    </div>
                    <h3>Mobile Optimized</h3>
                    <p>Seamless experience across all devices with responsive design and touch-friendly interface.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Enhanced Footer -->
    <footer class="footer">
        <div class="footer-background">
            <div class="footer-particles"></div>
        </div>
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="footer-logo">
                        <div class="logo-glow"></div>
                        <i class="fas fa-brain"></i>
                        <span>SearchIQ</span>
                    </div>
                    <p>Intelligent product discovery and spare parts recommendations powered by advanced AI technology.</p>
                    <div class="social-links">
                        <a href="#" class="social-link">
                            <i class="fab fa-twitter"></i>
                            <div class="social-ripple"></div>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-linkedin"></i>
                            <div class="social-ripple"></div>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-github"></i>
                            <div class="social-ripple"></div>
                        </a>
                    </div>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Product</h4>
                        <ul>
                            <li><a href="#">Features</a></li>
                            <li><a href="#">Pricing</a></li>
                            <li><a href="#">API</a></li>
                            <li><a href="#">Documentation</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Company</h4>
                        <ul>
                            <li><a href="#">About</a></li>
                            <li><a href="#">Blog</a></li>
                            <li><a href="#">Careers</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Support</h4>
                        <ul>
                            <li><a href="#">Help Center</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms of Service</a></li>
                            <li><a href="#">Status</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 SearchIQ. All rights reserved. Built with ❤️ and cutting-edge AI technology.</p>
            </div>
        </div>
    </footer>

    <!-- Include your existing JavaScript files -->
    <script src="{{ url_for('static', path='/js/spare_parts.js') }}"></script>
    <script src="{{ url_for('static', path='/js/app.js') }}"></script>
    
    <script>
        // Tab switching functionality
        function showTab(tabName, button) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab and activate button
            document.getElementById(tabName + '-tab').style.display = 'block';
            document.getElementById(tabName + '-tab').classList.add('active');
            button.classList.add('active');
            
            // Move tab indicator
            const tabWrapper = document.querySelector('.tab-wrapper');
            const indicator = document.querySelector('.tab-indicator');
            if (indicator && tabWrapper) {
                const activeIndex = Array.from(tabWrapper.children).indexOf(button);
                indicator.style.transform = `translateX(${activeIndex * 100}%)`;
            }
        }

        // Toggle advanced options
        function toggleAdvancedOptions() {
            const advancedOptions = document.querySelector('.advanced-options');
            const btn = document.querySelector('.show-advanced-btn');
            
            if (!advancedOptions || !btn) return;
            
            if (advancedOptions.style.display === 'none' || !advancedOptions.style.display) {
                advancedOptions.style.display = 'block';
                btn.classList.add('expanded');
                btn.querySelector('span').textContent = 'Hide Advanced Options';
            } else {
                advancedOptions.style.display = 'none';
                btn.classList.remove('expanded');
                btn.querySelector('span').textContent = 'Show Advanced Options';
            }
        }

        // Fill problem example
        function fillProblemExample(text) {
            const problemInput = document.getElementById('problem-description');
            const charCount = document.getElementById('char-count');
            
            if (problemInput) {
                problemInput.value = text;
                if (charCount) {
                    charCount.textContent = text.length;
                }
                
                // Trigger analysis preview
                showAnalysisPreview(text);
            }
        }

        // Enhanced character counter with real-time analysis
        const problemInput = document.getElementById('problem-description');
        if (problemInput) {
            problemInput.addEventListener('input', function() {
                const count = this.value.length;
                const charCountEl = document.getElementById('char-count');
                
                if (charCountEl) {
                    charCountEl.textContent = count;
                    
                    // Dynamic styling
                    if (count > 450) {
                        charCountEl.style.color = '#e53e3e';
                        charCountEl.style.fontWeight = '600';
                    } else if (count > 300) {
                        charCountEl.style.color = '#ed8936';
                        charCountEl.style.fontWeight = '500';
                    } else {
                        charCountEl.style.color = '#718096';
                        charCountEl.style.fontWeight = '400';
                    }
                }
                // Trigger real-time analysis preview
               if (count > 15) {
                   showAnalysisPreview(this.value);
               } else {
                   hideAnalysisPreview();
               }
           });
       }

       // Real-time analysis preview
       function showAnalysisPreview(text) {
           const preview = document.getElementById('analysis-preview');
           const deviceText = document.getElementById('detected-device-text');
           const issuesContainer = document.getElementById('detected-issues-tags');
           
           if (!preview || !deviceText || !issuesContainer) return;
           
           // Simple keyword detection for demo
           let detectedDevice = 'Unknown';
           const textLower = text.toLowerCase();
           
           if (textLower.includes('phone') || textLower.includes('mobile') || textLower.includes('smartphone')) {
               detectedDevice = 'Smartphone';
           } else if (textLower.includes('laptop') || textLower.includes('computer') || textLower.includes('macbook')) {
               detectedDevice = 'Laptop';
           } else if (textLower.includes('ac') || textLower.includes('air conditioner') || textLower.includes('cooling')) {
               detectedDevice = 'Air Conditioner';
           } else if (textLower.includes('tv') || textLower.includes('television')) {
               detectedDevice = 'Television';
           } else if (textLower.includes('washing machine') || textLower.includes('washer')) {
               detectedDevice = 'Washing Machine';
           } else if (textLower.includes('headphones') || textLower.includes('earphones')) {
               detectedDevice = 'Headphones';
           }
           
           deviceText.textContent = detectedDevice;
           
           // Detect issues
           const issues = [];
           if (textLower.includes('battery') || textLower.includes('charge') || textLower.includes('power')) {
               issues.push('Battery');
           }
           if (textLower.includes('screen') || textLower.includes('display') || textLower.includes('flicker')) {
               issues.push('Display');
           }
           if (textLower.includes('sound') || textLower.includes('audio') || textLower.includes('speaker')) {
               issues.push('Audio');
           }
           if (textLower.includes('cooling') || textLower.includes('cold') || textLower.includes('temperature')) {
               issues.push('Cooling');
           }
           if (textLower.includes('water') || textLower.includes('leak') || textLower.includes('drip')) {
               issues.push('Water');
           }
           if (textLower.includes('remote') || textLower.includes('control') || textLower.includes('button')) {
               issues.push('Remote');
           }
           if (textLower.includes('noise') || textLower.includes('sound') || textLower.includes('loud')) {
               issues.push('Noise');
           }
           
           issuesContainer.innerHTML = issues.map(issue => 
               `<span class="issue-tag">${issue}</span>`
           ).join('');
           
           preview.style.display = 'block';
       }

       function hideAnalysisPreview() {
           const preview = document.getElementById('analysis-preview');
           if (preview) {
               preview.style.display = 'none';
           }
       }

       // Voice input functionality
       const voiceBtn = document.getElementById('voice-input-btn');
       if (voiceBtn) {
           // Check if speech recognition is supported
           if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
               const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
               recognition.continuous = false;
               recognition.interimResults = false;
               recognition.lang = 'en-US';

               voiceBtn.addEventListener('click', () => {
                   recognition.start();
                   voiceBtn.classList.add('listening');
                   voiceBtn.querySelector('.voice-status').textContent = 'Listening...';
                   voiceBtn.disabled = true;
               });

               recognition.onresult = (event) => {
                   const transcript = event.results[0][0].transcript;
                   const problemInput = document.getElementById('problem-description');
                   if (problemInput) {
                       problemInput.value = transcript;
                       problemInput.dispatchEvent(new Event('input')); // Trigger the input event
                   }
               };

               recognition.onend = () => {
                   voiceBtn.classList.remove('listening');
                   voiceBtn.querySelector('.voice-status').textContent = 'Voice Input';
                   voiceBtn.disabled = false;
               };

               recognition.onerror = () => {
                   voiceBtn.classList.remove('listening');
                   voiceBtn.querySelector('.voice-status').textContent = 'Voice Input';
                   voiceBtn.disabled = false;
               };
           } else {
               // Hide voice button if not supported
               voiceBtn.style.display = 'none';
           }
       }

       // Enhanced loading states for AI
       function setAILoadingState(isLoading, step = 1) {
           const loadingContainer = document.getElementById('loading-indicator');
           const searchBtn = document.getElementById('search-spare-parts-btn');
           const progressSteps = document.querySelectorAll('.progress-step');
           const loadingStatus = document.getElementById('loading-status');
           
           if (loadingContainer) {
               loadingContainer.style.display = isLoading ? 'block' : 'none';
           }
           
           if (searchBtn) {
               searchBtn.disabled = isLoading;
               if (isLoading) {
                   searchBtn.querySelector('span').textContent = 'Analyzing...';
                   searchBtn.querySelector('i').className = 'fas fa-spinner fa-spin';
               } else {
                   searchBtn.querySelector('span').textContent = 'Analyze with AI';
                   searchBtn.querySelector('i').className = 'fas fa-brain';
               }
           }
           
           // Update progress steps
           if (isLoading && progressSteps.length > 0) {
               progressSteps.forEach((stepEl, index) => {
                   stepEl.classList.toggle('active', index < step);
               });
               
               // Update status text based on step
               const statusMessages = [
                   'Understanding your problem description...',
                   'Searching through parts database...',
                   'Calculating compatibility scores...',
                   'Personalizing recommendations...'
               ];
               
               if (loadingStatus && statusMessages[step - 1]) {
                   loadingStatus.textContent = statusMessages[step - 1];
               }
           }
       }

       // Enhanced search function to work with existing spare parts functionality
       async function enhancedSearchSpareParts() {
           const problemDescription = document.getElementById('problem-description')?.value?.trim();
           
           if (!problemDescription) {
               alert('Please describe your problem to get AI-powered recommendations');
               return;
           }

           // Show AI loading
           setAILoadingState(true, 1);
           
           // Simulate AI processing steps
           setTimeout(() => setAILoadingState(true, 2), 800);
           setTimeout(() => setAILoadingState(true, 3), 1600);
           setTimeout(() => setAILoadingState(true, 4), 2400);
           
           try {
               // Call your existing search function or API
               // This integrates with your existing spare_parts.js
               if (typeof searchSpareParts === 'function') {
                   // Use existing function but with enhanced UI
                   await searchSpareParts();
               } else {
                   // Fallback to direct API call
                   const response = await fetch('/api/spare-parts/recommend', {
                       method: 'POST',
                       headers: {
                           'Content-Type': 'application/json',
                       },
                       body: JSON.stringify({
                           problem_description: problemDescription,
                           brand: document.getElementById('brand-select')?.value || '',
                           device_model: document.getElementById('device-model')?.value || '',
                           max_results: 10,
                           ai_enhanced: true
                       })
                   });

                   if (response.ok) {
                       const data = await response.json();
                       displayEnhancedResults(data);
                   } else {
                       throw new Error('Failed to get recommendations');
                   }
               }
               
           } catch (error) {
               console.error('Search error:', error);
               alert('Unable to get recommendations. Please try again.');
           } finally {
               setTimeout(() => setAILoadingState(false), 3200);
           }
       }

       // Enhanced results display
       function displayEnhancedResults(data) {
           const resultsContainer = document.getElementById('recommendations-container');
           if (!resultsContainer) return;

           // Show analysis summary first
           displayAISummary(data);

           // Then show results using existing structure but enhanced
           if (data.recommendations && data.recommendations.length > 0) {
               let html = `
                   <div class="results-header">
                       <h3>🎯 ${data.recommendations.length} AI-Recommended Parts</h3>
                       <div class="performance-info">
                           Found in ${data.response_time || '< 1s'} • ${data.confidence || 'High'} Confidence
                       </div>
                   </div>
                   <div class="results-grid">
               `;

               data.recommendations.forEach(part => {
                   html += createEnhancedPartCard(part);
               });

               html += '</div>';
               resultsContainer.innerHTML = html;
           } else {
               resultsContainer.innerHTML = `
                   <div class="no-results">
                       <i class="fas fa-search"></i>
                       <h3>No parts found</h3>
                       <p>Try describing your problem differently or check the examples above.</p>
                   </div>
               `;
           }
       }

       // Display AI analysis summary
       function displayAISummary(data) {
           const summaryContainer = document.getElementById('analysis-summary');
           if (!summaryContainer) return;

           const html = `
               <div class="form-card">
                   <div class="form-header">
                       <h3>
                           <i class="fas fa-brain"></i>
                           AI Analysis Results
                       </h3>
                       <p>Here's what our AI understood from your description</p>
                   </div>
                   <div class="form-grid">
                       <div class="form-group">
                           <label class="form-label">
                               <i class="fas fa-microchip"></i>
                               Detected Device
                           </label>
                           <span class="analysis-result">${data.detected_device || 'Auto-detected'}</span>
                       </div>
                       <div class="form-group">
                           <label class="form-label">
                               <i class="fas fa-exclamation-triangle"></i>
                               Primary Issues
                           </label>
                           <div class="issues-tags">
                               ${(data.detected_issues || []).map(issue => 
                                   `<span class="issue-tag">${issue}</span>`
                               ).join('')}
                           </div>
                       </div>
                       <div class="form-group">
                           <label class="form-label">
                               <i class="fas fa-chart-line"></i>
                               Confidence Level
                           </label>
                           <span class="analysis-result">${data.confidence || 'High'} (${data.confidence_score || '95'}%)</span>
                       </div>
                   </div>
               </div>
           `;

           summaryContainer.innerHTML = html;
           summaryContainer.style.display = 'block';
       }

       // Create enhanced part card
       function createEnhancedPartCard(part) {
           return `
               <div class="result-item">
                   <div class="item-image">
                       <img src="${part.image_url || 'https://via.placeholder.com/300x200?text=Part+Image'}" 
                            alt="${part.part_name}" 
                            onerror="this.src='https://via.placeholder.com/300x200?text=Part+Image'">
                   </div>
                   <div class="item-title">${part.part_name}</div>
                   <div class="item-brand">Part #: ${part.part_number}</div>
                   
                   ${part.compatibility_score ? `
                       <div class="item-rating">
                           <div class="rating-stars">
                               <i class="fas fa-brain"></i>
                               ${Math.round(part.compatibility_score * 100)}% Match
                           </div>
                       </div>
                   ` : ''}
                   
                   <div class="item-price-section">
                       <span class="item-price">₹${part.price}</span>
                       <span class="item-category">${part.availability || 'Available'}</span>
                   </div>
                   
                   ${part.description ? `
                       <div class="item-features">${part.description}</div>
                   ` : ''}
                   
                   <div class="item-actions">
                       <button class="btn-cart" onclick="addToCart('${part.part_number}')">
                           <i class="fas fa-cart-plus"></i>
                           Add to Cart
                       </button>
                       <button class="btn-wishlist" onclick="viewDetails('${part.part_number}')">
                           <i class="fas fa-eye"></i>
                       </button>
                   </div>
               </div>
           `;
       }

       // Connect enhanced search to button
       const enhancedSearchBtn = document.getElementById('search-spare-parts-btn');
       if (enhancedSearchBtn) {
           enhancedSearchBtn.addEventListener('click', enhancedSearchSpareParts);
       }

       // Placeholder functions for cart and details (integrate with your existing functions)
       function addToCart(partNumber) {
           // Your existing add to cart functionality
           alert(`Added part ${partNumber} to cart!`);
       }

       function viewDetails(partNumber) {
           // Your existing view details functionality
           alert(`Viewing details for part ${partNumber}`);
       }

       // Initialize when page loads
       document.addEventListener('DOMContentLoaded', function() {
           console.log('Enhanced Spare Parts AI system initialized');
           
           // Initialize any existing systems
           if (typeof initializeSparePartsSystem === 'function') {
               initializeSparePartsSystem();
           }
       });
   </script>
</body>
</html>